(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-276454a4"],{2225:function(e,t,r){"use strict";r.r(t);var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("SplitLayout",[r("div",{attrs:{slot:"left"},slot:"left"},[r("sidebarClassify",{ref:"sidebarClassify",on:{change:e.onSidebar}})],1),r("div",{staticClass:"header-top",attrs:{slot:"top"},slot:"top"},[r("SearchForm",{on:{query:e.onQuery,reset:e.onResetForm}},[r("SearchFormItem",{attrs:{label:"范围："}},[r("a-tree-select",{staticStyle:{width:"160px"},attrs:{"dropdown-style":{maxHeight:"400px",overflow:"auto"},placeholder:"请选择范围","allow-clear":"",treeData:e.department,allowClear:"",treeDefaultExpandedKeys:e.defaultExpandedKeys},model:{value:e.form.deptId,callback:function(t){e.$set(e.form,"deptId",t)},expression:"form.deptId"}})],1),r("SearchFormItem",{staticStyle:{width:"360px"},attrs:{label:"用户姓名或账号："}},[r("a-input",{staticStyle:{width:"100%"},attrs:{placeholder:"请输入用户姓名或账号"},model:{value:e.form.keyWord,callback:function(t){e.$set(e.form,"keyWord",t)},expression:"form.keyWord"}})],1)],1)],1),r("div",{staticClass:"con-content"},[r("OperationPermission",{attrs:{check:"privs.item1010000002"}},[r("div",{staticClass:"add-but"},[1!==e.action?r("a-button",{attrs:{type:"primary"},on:{click:e.add}},[e._v("新建")]):e._e()],1)]),r("CustomTable",{ref:"table",attrs:{showAlert:!1,showSelection:!1,loading:e.loading.page,columns:e.columns,dataSource:e.pageData},on:{change:e.onTableChange},scopedSlots:e._u([{key:"action",fn:function(t){return[r("OperationPermission",{attrs:{check:"privs.item1010000003"}},[1!==t.action?r("a",{staticStyle:{"margin-right":"16px"},on:{click:function(r){return e.edit(t)}}},[e._v("编辑")]):e._e()]),r("OperationPermission",{attrs:{check:"privs.item1010000004"}},[r("a-popconfirm",{attrs:{title:"是否确定删除该用户权限？","ok-text":"是","cancel-text":"否"},on:{confirm:function(r){return e.del(t)}}},[(t.mainRoleName||t.roleName)&&1!==t.action?r("a",{staticStyle:{"margin-right":"16px"}},[e._v("删除")]):e._e()])],1),r("OperationPermission",{attrs:{check:"privs.item1010000006"}},[1!==t.action?r("a",{on:{click:function(r){return e.copy(t)}}},[e._v("复制角色到用户")]):e._e()])]}}])})],1),r("Modal",{ref:"modal",attrs:{title:e.title,width:800},on:{ok:e.submit}},[r("div",{staticClass:"add-user"},[r("a-row",{staticClass:"item-row"},["add"===e.type?r("a-col",{staticClass:"explain",attrs:{span:24}},[e._v("说明：新添加的角色会与用户的原有角色进行合并")]):e._e(),"copy"===e.type?r("a-col",{staticClass:"explain",attrs:{span:24}},[e._v("说明：复制的角色将覆盖员工原有角色，CRM管理员角色不复制")]):e._e()],1),r("a-row",{staticClass:"item-row"},[r("SelectUser",{attrs:{multiple:!0,disabled:e.disabled,isUser:!0},on:{change:e.onSelectTree},model:{value:e.userForm.userIds,callback:function(t){e.$set(e.userForm,"userIds",t)},expression:"userForm.userIds"}})],1),r("a-row",{staticClass:"item-row"},[r("a-col",{staticClass:"item-subhead",attrs:{span:24}},[e._v("用户角色配置：")])],1),r("a-checkbox-group",{staticStyle:{width:"100%"},on:{change:e.onUserRoles},model:{value:e.userForm.roleIds,callback:function(t){e.$set(e.userForm,"roleIds",t)},expression:"userForm.roleIds"}},e._l(e.roleGroupData,(function(t,o){return r("a-row",{directives:[{name:"show",rawName:"v-show",value:t.roleInfoVOList.length>0,expression:"item.roleInfoVOList.length > 0"}],key:o,staticClass:"item-row"},[r("a-col",{staticClass:"item-title",attrs:{span:5}},[e._v(e._s(t.groupName)+"：")]),r("a-col",{staticStyle:{display:"flex","flex-wrap":"wrap"},attrs:{span:19}},e._l(t.roleInfoVOList,(function(t,o){return r("a-checkbox",{key:o,attrs:{value:t.id}},[e._v(" "+e._s(t.roleName)+" ")])})),1)],1)})),1),r("a-row",{staticClass:"item-row"},[r("a-col",{staticClass:"item-subhead",attrs:{span:24}},[e._v("主角色：")])],1),r("a-row",{staticClass:"item-row"},[r("a-col",{attrs:{span:24}},[r("a-select",{staticStyle:{width:"100%"},attrs:{placeholder:"+选择主角色"},model:{value:e.userForm.majorRoleId,callback:function(t){e.$set(e.userForm,"majorRoleId",t)},expression:"userForm.majorRoleId"}},e._l(e.protagonistColorData,(function(t,o){return r("a-select-option",{key:o,attrs:{value:t.id}},[e._v(" "+e._s(t.roleName)+" ")])})),1)],1)],1),"add"===e.type?r("a-row",{staticClass:"item-row"},[r("a-col",{staticClass:"item-col-100",attrs:{span:24}},[r("a-checkbox",{model:{value:e.userForm.updateFlag,callback:function(t){e.$set(e.userForm,"updateFlag",t)},expression:"userForm.updateFlag"}},[e._v("已有主角色的用户和部门，不更新主角色")])],1)],1):e._e()],1)])],1)},a=[],s=(r("caad"),r("d81d"),r("2532"),r("5530")),n=(r("96cf"),r("1da1")),i=r("2f62"),l=r("d74e"),c=r("86da"),u=r("a669"),d=r("d99e"),m=d["a"].Item,p={name:"BusinessUser",components:{SearchForm:d["a"],SearchFormItem:m,Modal:c["a"],sidebarClassify:l["a"],SelectUser:u["a"]},data:function(){return{department:[],columns:[{title:"用户姓名",dataIndex:"name"},{title:"主属部门",dataIndex:"deptName"},{title:"个人账号",dataIndex:"username"},{title:"职位",dataIndex:"jobName"},{title:"主角色",dataIndex:"mainRoleName"},{title:"角色",dataIndex:"roleName"},{title:"操作",width:"220px",align:"center",scopedSlots:{customRender:"action"}}],form:{},pageFilter:{currentPage:1},userRolesValue:[],isProtagonistColor:!1,userForm:{majorRoleId:"",roleIds:[],updateFlag:!1,userIds:[]},protagonistColorData:[],type:"add",title:"添加用户",action:1,groupId:1,disabled:!1,defaultExpandedKeys:[]}},created:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.refreshTable();case 2:return t.next=4,e.getTree();case 4:e.department=e.treeData.length>0&&e.treeData[0].length>0?e.treeData[0]:e.treeData,e.defaultExpandedKeys=e.department&&e.department.length>0?[e.department[0].key]:[];case 6:case"end":return t.stop()}}),t)})))()},computed:Object(s["a"])({},Object(i["d"])({loading:function(e){return e.SysRoleController.loading},pageData:function(e){return e.SysRoleController.pageData},roleGroupData:function(e){return e.SysRoleController.roleGroupData},detailData:function(e){return e.SysRoleController.detailData},treeData:function(e){return e.SysDepartment.treeData}})),methods:Object(s["a"])(Object(s["a"])({},Object(i["b"])({onPage:"SysRoleController/onPage",onDel:"SysRoleController/onDel",onRoleGroupList:"SysRoleController/onRoleGroupList",onAddUser:"SysRoleController/onAddUser",onRoleInfo:"SysRoleController/onRoleInfo",onUpdateUser:"SysRoleController/onUpdateUser",onDeleteUser:"SysRoleController/onDeleteUser",onCopyUser:"SysRoleController/onCopyUser",getTree:"SysDepartment/getTree"})),{},{onSidebar:function(e,t,r){this.action=t,this.groupId=r,this.form.roleId=e,this.refreshTable()},refreshTable:function(){this.onPage(Object(s["a"])(Object(s["a"])({},this.form),this.pageFilter))},onTableChange:function(e){this.pageFilter=e,this.refreshTable()},onQuery:function(){this.pageFilter.currentPage=1,this.refreshTable()},onResetForm:function(){delete this.form.deptId,delete this.form.keyWord,this.refreshTable()},add:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.type="add",e.$refs.modal.visible=!0,e.userForm.roleIds=[],e.userForm.userIds=[],e.userForm.updateFlag=!1,e.userForm.majorRoleId="",e.disabled=!1,e.protagonistColorData=[],t.next=10,e.onRoleGroupList();case 10:1!==e.groupId&&(e.userForm.roleIds.push(e.form.roleId),e.userForm.majorRoleId=e.form.roleId,e.arrayProcessing(e.userForm.roleIds));case 11:case"end":return t.stop()}}),t)})))()},onSelectTree:function(e){this.userForm.userIds=e},onUserRoles:function(e){console.log(e),this.arrayProcessing(e),this.userForm.majorRoleId=e[0]},arrayProcessing:function(e){var t=this;this.protagonistColorData=[],this.roleGroupData.map((function(r){r.roleInfoVOList.map((function(r){e.includes(r.id)&&t.protagonistColorData.push({id:r.id,roleName:r.roleName})}))}))},edit:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.type="edit",t.title="编辑用户",t.$refs.modal.visible=!0,t.userForm.roleIds=[],t.userForm.userIds=[],t.disabled=!0,r.next=8,t.onRoleInfo(e.userId);case 8:return o=Object.assign({},t.detailData),t.userForm.userIds.push(o.userId),t.userForm.roleIds=o.roleIds,t.userForm.majorRoleId=o.majorRoleId,r.next=14,t.onRoleGroupList();case 14:t.arrayProcessing(o.roleIds);case 15:case"end":return r.stop()}}),r)})))()},submit:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if("add"!==e.type){t.next=5;break}return t.next=3,e.onAddUser(e.userForm).then((function(){e.$message.success("新建成功")}));case 3:t.next=12;break;case 5:if("edit"!==e.type){t.next=10;break}return t.next=8,e.onUpdateUser({roleIds:e.userForm.roleIds,majorRoleId:e.userForm.majorRoleId,userId:e.userForm.userIds[0]}).then((function(){e.$message.success("保存成功")}));case 8:t.next=12;break;case 10:return t.next=12,e.onCopyUser({majorRoleId:e.userForm.majorRoleId,roleIds:e.userForm.roleIds,userIds:e.userForm.userIds}).then((function(){e.$message.success("复制成功")}));case 12:e.$refs.modal.visible=!1,e.refreshTable();case 14:case"end":return t.stop()}}),t)})))()},del:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.onDeleteUser(e.userId).then((function(){t.$message.success("删除成功")}));case 2:t.$refs.sidebarClassify.initialize(),t.refreshTable();case 4:case"end":return r.stop()}}),r)})))()},copy:function(e){var t=this;return Object(n["a"])(regeneratorRuntime.mark((function r(){var o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return t.type="copy",t.title="复制角色到用户",t.$refs.modal.visible=!0,t.userForm.roleIds=[],t.userForm.userIds=[],t.disabled=!0,r.next=8,t.onRoleInfo(e.userId);case 8:return o=Object.assign({},t.detailData),t.userForm.userIds.push(o.userId),t.userForm.roleIds=o.roleIds,t.userForm.majorRoleId=o.majorRoleId,r.next=14,t.onRoleGroupList();case 14:t.arrayProcessing(o.roleIds);case 15:case"end":return r.stop()}}),r)})))()}})},f=p,h=(r("d185"),r("2877")),v=Object(h["a"])(f,o,a,!1,null,"7b64f4d7",null);t["default"]=v.exports},"55fc":function(e,t,r){},"717d":function(e,t,r){},"8cc5":function(e,t,r){"use strict";var o=r("d41e"),a=r.n(o);a.a},d185:function(e,t,r){"use strict";var o=r("55fc"),a=r.n(o);a.a},d41e:function(e,t,r){},d74e:function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"sidebar-classify"},[0===e.outRoleGroupList.length?r("a-skeleton",{attrs:{active:""}}):e._e(),r("a-row",e._l(e.outRoleGroupList,(function(t,o){return r("a-col",{key:o,attrs:{span:24}},[2===t.groupType?r("div",{staticClass:"title item"},[e._v(" "+e._s(t.groupName)+" "),r("span",{staticClass:"new-built",on:{click:e.add}},[e._v("+新建")])]):r("div",{staticClass:"title item"},[e._v(e._s(t.groupName))]),r("a-row",e._l(t.roleInfoVOList,(function(o,a){return r("a-col",{key:a,staticClass:"item item-col",class:{active:e.isActive===o.id},attrs:{span:24},on:{click:function(r){return e.onItem(o.id,t.action,t.groupId)}}},[2===t.groupType?r("div",{staticClass:"item-roleName"},[e._v(" "+e._s(o.roleName)+" "),r("span",{staticClass:"item-bnt"},[r("a-icon",{attrs:{type:"edit"},on:{click:function(t){return t.stopPropagation(),e.edit(o)}}}),r("a-icon",{attrs:{type:"delete"},on:{click:function(t){return t.stopPropagation(),e.del(o)}}})],1)]):r("div",{staticClass:"item-roleName"},[e._v(e._s(o.roleName))])])})),1)],1)})),1),r("Modal",{ref:"modal",attrs:{title:e.title},on:{ok:e.submit}},[r("a-row",{staticClass:"item-row"},[r("a-col",{staticClass:"item-title",attrs:{span:6}},[r("em",{staticStyle:{color:"#f00"}},[e._v("*")]),e._v("角色名称：")]),r("a-col",{attrs:{span:14}},[r("a-input",{attrs:{placeholder:"请输入角色名称"},model:{value:e.form.roleName,callback:function(t){e.$set(e.form,"roleName",t)},expression:"form.roleName"}})],1)],1),r("a-row",{staticClass:"item-row"},[r("a-col",{staticClass:"item-title",attrs:{span:6}},[e._v("角色描述：")]),r("a-col",{attrs:{span:14}},[r("a-textarea",{attrs:{placeholder:"请输入角色描述"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1),"add"===e.type?r("a-row",{staticClass:"item-row"},[r("a-col",{staticClass:"item-title",attrs:{span:6}},[e._v("角色权限：")]),r("a-col",{attrs:{span:14}},[r("a-checkbox",{model:{value:e.form.isCopy,callback:function(t){e.$set(e.form,"isCopy",t)},expression:"form.isCopy"}}),r("a-select",{staticStyle:{width:"306px","margin-left":"20px"},attrs:{showSearch:"",placeholder:"选择角色权限",optionFilterProp:"children"},on:{change:e.handleChange}},e._l(e.roleData,(function(t,o){return r("a-select-option",{key:o,attrs:{value:t.id}},[e._v(e._s(t.roleName))])})),1)],1)],1):e._e()],1)],1)},a=[],s=(r("a4d3"),r("e01a"),r("99af"),r("d81d"),r("2909")),n=(r("96cf"),r("1da1")),i=r("5530"),l=r("2f62"),c=r("86da"),u={components:{Modal:c["a"]},data:function(){return{isActive:null,title:"新建角色",form:{roleName:"",description:"",isCopy:!1,copyRoleId:""},roleData:[],type:"add",id:""}},computed:Object(i["a"])({},Object(l["d"])({outRoleGroupList:function(e){return e.SysRoleController.outRoleGroupList}})),created:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.initialize();case 1:case"end":return t.stop()}}),t)})))()},methods:Object(i["a"])(Object(i["a"])({},Object(l["b"])({onIsOutRoleGroupList:"SysRoleController/onIsOutRoleGroupList",onAdd:"SysRoleController/onAdd",onUpdate:"SysRoleController/onUpdate",onDel:"SysRoleController/onDel"})),{},{initialize:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.onIsOutRoleGroupList();case 2:return console.log(e.outRoleGroupList),t.next=5,e.onItem(e.outRoleGroupList[0].roleInfoVOList[0].id,e.outRoleGroupList[0].action,e.outRoleGroupList[0].groupId);case 5:return t.next=7,e.getRoleData();case 7:case"end":return t.stop()}}),t)})))()},onItem:function(e,t,r){this.isActive=e,this.$emit("change",e,t,r)},getRoleData:function(){var e=this;this.outRoleGroupList.map((function(t){var r;(r=e.roleData).push.apply(r,Object(s["a"])(t.roleInfoVOList))}))},getARoleData:function(){var e=this;this.roleData=[],this.outRoleGroupList.map((function(t){e.roleData=e.roleData.concat(t.roleInfoVOList)}))},add:function(){this.type="add",this.title="新建角色",this.form.roleName="",this.form.description="",this.form.isCopy=!1,this.form.copyRoleId="",this.$refs.modal.visible=!0},edit:function(e){this.type="edit",this.title="编辑角色",this.$refs.modal.visible=!0,this.id=e.id,this.form.roleName=e.roleName,this.form.description=e.description},del:function(e){var t=this;this.$confirm({title:"角色删除确认",content:"确定要将“".concat(e.roleName,"”角色删除?"),onOk:function(){return Object(n["a"])(regeneratorRuntime.mark((function r(){return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:return r.next=2,t.onDel(e.id);case 2:return r.next=4,t.onIsOutRoleGroupList();case 4:return r.next=6,t.getARoleData();case 6:case"end":return r.stop()}}),r)})))()},onCancel:function(){}})},handleChange:function(e){this.form.copyRoleId=e},submit:function(){var e=this;return Object(n["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e.$refs.modal.visible=!1,"add"!==e.type){t.next=6;break}return t.next=4,e.onAdd(e.form);case 4:t.next=8;break;case 6:return t.next=8,e.onUpdate({id:e.id,roleName:e.form.roleName,description:e.form.description});case 8:return t.next=10,e.onIsOutRoleGroupList();case 10:return t.next=12,e.getARoleData();case 12:case"end":return t.stop()}}),t)})))()}})},d=u,m=(r("dec6"),r("2877")),p=Object(m["a"])(d,o,a,!1,null,"3387114c",null);t["a"]=p.exports},d99e:function(e,t,r){"use strict";var o=function(){var e=this,t=e.$createElement,r=e._self._c||t;return r("div",{staticClass:"search-wrapper"},[r("div",[r("a-row",{attrs:{gutter:56}},[e._t("default"),r("buttonBox",{style:e.advanced?{float:"right"}:{},on:{toggleAdvanced:e.toggleAdvanced,query:e.query,reset:e.reset}})],2)],1)])},a=[],s=(r("a9e3"),r("5530")),n={name:"SearchListItem",props:{label:{type:String,default:"",required:!1}},inject:{col:{type:Number}},render:function(){var e=arguments[0];return e("a-col",{class:"item-box",props:Object(s["a"])({},l[this.col])},[e("div",{class:"y-search-item"},[e("div",{class:"y-search-label"},[this.$props.label]),e("div",{class:"y-search-content"},[this.$slots.default])])])}},i={name:"buttonBox",data:function(){return{advanced:!1}},inject:{col:{type:Number}},methods:{toggleAdvanced:function(){this.advanced=!this.advanced,this.$emit("toggleAdvanced")},query:function(){this.$emit("query")},reset:function(){this.$emit("reset")}},render:function(){var e=arguments[0];return e("a-col",{props:Object(s["a"])({},l[this.col])},[e("span",{class:"table-page-search-submitButtons",style:"float: 'left', overflow: 'hidden'"},[e("a-button",{attrs:{type:"primary"},on:{click:this.query}},["查询"]),e("a-button",{style:"margin-left: 8px",on:{click:this.reset}},["重置"]),e("a",{attrs:{id:"advance-btn"},style:"margin-left: 8px",on:{click:this.toggleAdvanced}},[this.advanced?"收起":"展开",e("a-icon",{props:Object(s["a"])({},{type:this.advanced?"up":"down"})})])])])}},l={1:{xs:24},2:{xs:24,sm:12},3:{xs:24,sm:12,md:8},4:{md:24,lg:12,xl:8,xxl:6}},c={name:"SearchForm",Item:n,components:{buttonBox:i},props:{col:{type:Number,required:!1,default:6}},provide:function(){return{col:this.col>4?4:this.col}},data:function(){return{advanced:!1,toplist:[],bottomList:[]}},methods:{toggleAdvanced:function(){this.advanced=!this.advanced,this.displayItem()},query:function(){this.$emit("query")},reset:function(){this.$emit("reset")},displayItem:function(){var e=this.$slots.default,t=this.col,r=e.length;if(r<t)document.getElementById("advance-btn").style.display="none";else for(var o=t-1;o<r;o++)e[o].elm.style.display=this.advanced?"":"none"}},mounted:function(){this.displayItem()}},u=c,d=(r("8cc5"),r("2877")),m=Object(d["a"])(u,o,a,!1,null,"359e9f37",null),p=m.exports;t["a"]=p},dec6:function(e,t,r){"use strict";var o=r("717d"),a=r.n(o);a.a}}]);