(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4c24e271","chunk-53c56e5c","chunk-7991054e","chunk-270c8fe8"],{"32a3":function(e,t,a){},"3cff":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"filter-wrapper"},[a("div",{staticClass:"filter-title"},[e._v("且（AND）")]),a("div",{staticClass:"filter-list"},[e._l(e.items,(function(t,r){return a("div",{key:r,staticClass:"filter-item"},[a("div",{staticClass:"filter-line"}),a("div",{staticClass:"filter-content"},[a("a-cascader",{staticClass:"content-item",attrs:{allowClear:!1,options:e.data,value:t[0]&&t[1]?t:null,expandTrigger:"hover",placeholder:"请选择"},on:{change:function(t){return e.onChange(t,r)}}}),a("a-input",{staticClass:"content-item",attrs:{placeholder:"请输入"},model:{value:t[2],callback:function(a){e.$set(t,2,a)},expression:"item[2]"}}),e.items.length>1?a("a-icon",{staticClass:"content-icon",attrs:{type:"delete"},on:{click:function(t){return e.deleteItem(r)}}}):e._e()],1)])})),a("div",{staticClass:"filter-item"},[a("span",{staticClass:"filter-line filter-line-last"}),a("div",{staticClass:"filter-content"},[a("a-button",{staticClass:"content-button",attrs:{type:"dashed",block:"",icon:"plus"},on:{click:e.addItem}})],1)])],2)])},n=[],i=(a("a434"),{name:"CustomFilter",props:{data:{type:Array,required:!0},items:{type:Array,default:function(){return[[null,null,""]]}}},data:function(){return{}},methods:{addItem:function(){this.items.push([null,null,""])},deleteItem:function(e){this.items.length>1&&this.items.splice(e,1)},onChange:function(e,t){e.push(this.items[t][2]),this.items.splice(t,1,e)}}}),s=i,o=(a("4cfd"),a("2877")),l=Object(o["a"])(s,r,n,!1,null,"6e08c210",null);t["default"]=l.exports},4602:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Modal",{ref:"modal",attrs:{title:"新建",width:this.$config.modalWidth.middling},on:{ok:e.okHandler}},[a("a-form",{attrs:{form:e.form,labelCol:{span:6},wrapperCol:{span:18}}},[a("a-form-item",{attrs:{label:"数据来源范围"}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["dataRange",{rules:[{required:!0,message:"请选择数据来源范围"}],initialValue:1}],expression:"[\n          'dataRange',\n          {\n            rules: [{ required: true, message: '请选择数据来源范围' }],\n            initialValue: 1,\n          },\n        ]"}]},[a("a-radio",{attrs:{value:1}},[e._v("基于数据来源")]),a("a-radio",{attrs:{value:2}},[e._v("基于条件")])],1)],1),2===this.form.getFieldValue("dataRange")?a("a-form-item",{attrs:{label:"规则名称"}},[a("a-input",{directives:[{name:"decorator",rawName:"v-decorator",value:["ruleName",{rules:[{required:!0,message:"请输入规则名称"}],initialValue:e.ruleName}],expression:"[\n          'ruleName',\n          {\n            rules: [{ required: true, message: '请输入规则名称' }],\n            initialValue: ruleName,\n          },\n        ]"}],attrs:{placeholder:"请输入规则名称"},on:{change:e.onNameChange}})],1):e._e(),a("a-form-item",{attrs:{label:"数据来源"}},[a("SelectUser",{directives:[{name:"decorator",rawName:"v-decorator",value:["dataComesFrom",{rules:[{required:!0,message:"请选择数据来源"}]}],expression:"[\n          'dataComesFrom',\n          {\n            rules: [{ required: true, message: '请选择数据来源' }],\n          },\n        ]"}],attrs:{multiple:!0,placeholder:"请选择数据来源"}})],1),a("a-form-item",{attrs:{label:"共享对象"}},[a("a-select",{directives:[{name:"decorator",rawName:"v-decorator",value:["tableMetaId",{rules:[{required:!0,message:"请输入共享对象"}],initialValue:0===e.tableMetaId?null:e.tableMetaId}],expression:"[\n          'tableMetaId',\n          {\n            rules: [{ required: true, message: '请输入共享对象' }],\n            initialValue: tableMetaId === 0 ? null : tableMetaId,\n          },\n        ]"}],staticStyle:{width:"100%"},attrs:{placeholder:"请输入共享对象"},on:{select:e.onShareObjectSelect}},e._l(e.objectsAndConditionsData,(function(t){return a("a-select-option",{key:t.objectMetaId,attrs:{value:t.objectMetaId,options:t.options}},[e._v(" "+e._s(t.objectTitle)+" ")])})),1)],1),a("a-form-item",{directives:[{name:"show",rawName:"v-show",value:2===this.form.getFieldValue("dataRange"),expression:"this.form.getFieldValue('dataRange') === 2"}],attrs:{wrapperCol:{offset:3,span:21}}},[a("CustomFilter",{attrs:{data:e.options,items:e.filterItems}})],1),a("a-form-item",{attrs:{label:"共享范围"}},[a("SelectUser",{directives:[{name:"decorator",rawName:"v-decorator",value:["dataShareTo",{rules:[{required:!0,message:"请选择共享范围"}]}],expression:"[\n          'dataShareTo',\n          {\n            rules: [{ required: true, message: '请选择共享范围' }],\n          },\n        ]"}],attrs:{multiple:!0,placeholder:"请选择共享范围"}})],1),a("a-form-item",[a("span",{attrs:{slot:"label"},slot:"label"},[e._v(" 到期时间 "),a("a-tooltip",{attrs:{title:"数据权限有效时间，当为空时表示永久"}},[a("a-icon",{attrs:{type:"question-circle-o"}})],1)],1),a("a-date-picker",{directives:[{name:"decorator",rawName:"v-decorator",value:["expireDateTime"],expression:"['expireDateTime']"}],staticStyle:{width:"100%"},attrs:{showTime:"",placeholder:"为空表示永久"}})],1),a("a-form-item",{attrs:{label:"共享权限"}},[a("a-radio-group",{directives:[{name:"decorator",rawName:"v-decorator",value:["flagPriv",{rules:[{required:!0,message:"请选择共享权限"}],initialValue:!1}],expression:"[\n          'flagPriv',\n          {\n            rules: [{ required: true, message: '请选择共享权限' }],\n            initialValue: false,\n          },\n        ]"}]},[a("a-radio",{attrs:{value:!1}},[e._v("只读")]),a("a-radio",{attrs:{value:!0,disabled:!0}},[e._v("读写")])],1)],1)],1)],1)},n=[],i=(a("4de4"),a("d81d"),a("a9e3"),a("5530")),s=a("2f62"),o=a("86da"),l=a("a669"),c=a("3cff"),d=(a("c32a"),{name:"AddDataShareModal",components:{Modal:o["a"],CustomFilter:c["default"],SelectUser:l["a"]},props:{tableMetaId:{type:Number,required:!1,default:0}},data:function(){return{form:this.$form.createForm(this),filterItems:[[]],ruleName:"",options:[]}},mounted:function(){},computed:Object(i["a"])({},Object(s["d"])({loading:function(e){return e.SysPrivilege.loading},objectsAndConditionsData:function(e){return e.SysPrivilege.objectsAndConditionsData}})),watch:{tableMetaId:function(e){var t=this.objectsAndConditionsData.filter((function(t){return t.objectMetaId===e}))[0];this.options=t?t.options:[]}},methods:Object(i["a"])(Object(i["a"])({},Object(s["b"])({onSaveDataSharing:"SysPrivilege/onSaveDataSharing"})),{},{show:function(){this.form.resetFields(),this.filterItems=[[]],this.$refs.modal.show()},onNameChange:function(e){this.ruleName=e.target.value},onShareObjectSelect:function(e,t){this.options=t.data.attrs.options||[]},okHandler:function(){var e=this,t=this.form.validateFields,a=this.filterItems;t((function(t,r){console.log(JSON.stringify(r),a,a.map((function(e){return{fieldComparator:e[1]||0,fieldComparatorValue:e[2]||"",fieldMetaId:e[0]||0}}))),t||e.onSaveDataSharing(Object(i["a"])(Object(i["a"])({},r),{},{dataComesFrom:r.dataComesFrom.map((function(e){return{id:e,type:0}})),dataShareTo:r.dataShareTo.map((function(e){return{id:e,type:0}})),objectConditions:2===r.dataRange?a.map((function(e){return{fieldComparator:e[1]||0,fieldComparatorValue:e[2]||"",fieldMetaId:e[0]||0}})):[]})).then((function(){e.$message.success("新建成功"),e.$emit("success"),e.$refs.modal.close()}))}))}})}),u=d,m=a("2877"),f=Object(m["a"])(u,r,n,!1,null,"627b2f15",null);t["default"]=f.exports},"4cfd":function(e,t,a){"use strict";var r=a("6d3a"),n=a.n(r);n.a},"6d3a":function(e,t,a){},"8a01":function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("Drawer",{ref:"drawer",attrs:{title:"共享详情",width:500}},[a("DescriptionList",{attrs:{col:1}},[a("DescriptionListItem",{attrs:{term:"数据来源范围"}},[e._v(e._s(""===e.data.ruleName?"基于数据来源":"基于条件"))]),e.data.ruleName?a("DescriptionListItem",{attrs:{term:"规则名称"}},[e._v(e._s(e.data.ruleName))]):e._e(),a("DescriptionListItem",{attrs:{term:"数据来源"}},[e._v(e._s(e.data.comeFromName))]),a("DescriptionListItem",{attrs:{term:"共享对象"}},[e._v(e._s(e.data.sharedModuleTitle))]),a("DescriptionListItem",{attrs:{term:"共享范围"}},[e._v(e._s(e.data.titleShareTo))]),a("DescriptionListItem",{attrs:{term:"共享权限"}},[e._v(e._s(e.data.privValue?"读写":"只读"))]),a("DescriptionListItem",{attrs:{term:"到期时间"}},[e._v(e._s(e.data.expireTo?e.moment(e.data.expireTo).format("YYYY-MM-DD HH:mm:ss"):"永久"))]),a("DescriptionListItem",{attrs:{term:"状态"}},[e._v(e._s(e.data.flagEnable?"启用中":"停用中"))])],1)],1)},n=[],i=a("b1fe"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{class:["description-list",e.size,"vertical"===e.layout?"vertical":"horizontal"]},[e.title?a("div",{staticClass:"title"},[e._v(e._s(e.title))]):e._e(),a("a-row",[e._t("default")],2)],1)},o=[],l=(a("a9e3"),a("5530")),c=a("da05"),d={name:"DetailListItem",props:{term:{type:String,default:"",required:!1}},components:{Col:c["b"]},inject:{col:{type:Number}},render:function(){var e=arguments[0];return e(c["b"],{props:Object(l["a"])({},u[this.col])},[e("div",{class:"term"},[this.$props.term]),e("div",{class:"content"},[this.$slots.default])])}},u={1:{xs:24},2:{xs:24,sm:12},3:{xs:24,sm:12,md:8},4:{xs:24,sm:12,md:6}},m={name:"DetailList",Item:d,props:{title:{type:String,default:"",required:!1},col:{type:Number,required:!1,default:3},size:{type:String,required:!1,default:"small"},layout:{type:String,required:!1,default:"horizontal"}},provide:function(){return{col:this.col>4?4:this.col}}},f=m,h=(a("92b8"),a("2877")),p=Object(h["a"])(f,s,o,!1,null,"44d36289",null),v=p.exports,b=v,g=b.Item,y={name:"ViewDataShareModal",components:{Drawer:i["a"],DescriptionList:b,DescriptionListItem:g},props:{data:{type:Object,required:!0}},data:function(){return{}},mounted:function(){},computed:{},methods:{show:function(){this.$refs.drawer.show()}}},S=y,_=Object(h["a"])(S,r,n,!1,null,"4b6a99f5",null);t["default"]=_.exports},"8cc5":function(e,t,a){"use strict";var r=a("d41e"),n=a.n(r);n.a},"92b8":function(e,t,a){"use strict";var r=a("32a3"),n=a.n(r);n.a},b1fe:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("a-drawer",{attrs:{title:e.title,width:e.width,maskClosable:!0,placement:"right",closable:!0,wrapClassName:"dwBox",visible:e.visible},on:{close:e.onClose}},[e._t("default")],2)],1)},n=[],i=(a("a9e3"),{name:"Drawer",props:{title:{type:String,default:"标题"},width:{type:Number,default:640}},data:function(){return{visible:!1}},created:function(){},mounted:function(){},methods:{show:function(){this.visible=!0},onClose:function(){this.visible=!1}}}),s=i,o=a("2877"),l=Object(o["a"])(s,r,n,!1,null,null,null);t["a"]=l.exports},d41e:function(e,t,a){},d99e:function(e,t,a){"use strict";var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"search-wrapper"},[a("div",[a("a-row",{attrs:{gutter:56}},[e._t("default"),a("buttonBox",{style:e.advanced?{float:"right"}:{},on:{toggleAdvanced:e.toggleAdvanced,query:e.query,reset:e.reset}})],2)],1)])},n=[],i=(a("a9e3"),a("5530")),s={name:"SearchListItem",props:{label:{type:String,default:"",required:!1}},inject:{col:{type:Number}},render:function(){var e=arguments[0];return e("a-col",{class:"item-box",props:Object(i["a"])({},l[this.col])},[e("div",{class:"y-search-item"},[e("div",{class:"y-search-label"},[this.$props.label]),e("div",{class:"y-search-content"},[this.$slots.default])])])}},o={name:"buttonBox",data:function(){return{advanced:!1}},inject:{col:{type:Number}},methods:{toggleAdvanced:function(){this.advanced=!this.advanced,this.$emit("toggleAdvanced")},query:function(){this.$emit("query")},reset:function(){this.$emit("reset")}},render:function(){var e=arguments[0];return e("a-col",{props:Object(i["a"])({},l[this.col])},[e("span",{class:"table-page-search-submitButtons",style:"float: 'left', overflow: 'hidden'"},[e("a-button",{attrs:{type:"primary"},on:{click:this.query}},["查询"]),e("a-button",{style:"margin-left: 8px",on:{click:this.reset}},["重置"]),e("a",{attrs:{id:"advance-btn"},style:"margin-left: 8px",on:{click:this.toggleAdvanced}},[this.advanced?"收起":"展开",e("a-icon",{props:Object(i["a"])({},{type:this.advanced?"up":"down"})})])])])}},l={1:{xs:24},2:{xs:24,sm:12},3:{xs:24,sm:12,md:8},4:{md:24,lg:12,xl:8,xxl:6}},c={name:"SearchForm",Item:s,components:{buttonBox:o},props:{col:{type:Number,required:!1,default:6}},provide:function(){return{col:this.col>4?4:this.col}},data:function(){return{advanced:!1,toplist:[],bottomList:[]}},methods:{toggleAdvanced:function(){this.advanced=!this.advanced,this.displayItem()},query:function(){this.$emit("query")},reset:function(){this.$emit("reset")},displayItem:function(){var e=this.$slots.default,t=this.col,a=e.length;if(a<t)document.getElementById("advance-btn").style.display="none";else for(var r=t-1;r<a;r++)e[r].elm.style.display=this.advanced?"":"none"}},mounted:function(){this.displayItem()}},d=c,u=(a("8cc5"),a("2877")),m=Object(u["a"])(d,r,n,!1,null,"359e9f37",null),f=m.exports;t["a"]=f},eaa7:function(e,t,a){"use strict";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("SplitLayout",[a("AddDataShareModal",{ref:"addDataShareModal",attrs:{tableMetaId:e.tableMetaId},on:{success:e.refreshTable}}),a("ViewDataShareModal",{ref:"viewDataShareModal",attrs:{data:e.selectedData}}),a("div",{attrs:{slot:"left"},slot:"left"},[a("a-menu",{attrs:{mode:"vertical",defaultSelectedKeys:[0]},on:{click:e.onLeftMenuClick}},[a("a-menu-item",{key:0},[e._v(" 全部对象 ")]),e._l(e.objectsAndConditionsData,(function(t){return a("a-menu-item",{key:t.objectMetaId},[e._v(" "+e._s(t.objectTitle)+" ")])}))],2)],1),a("div",{attrs:{slot:"top"},slot:"top"},[a("SearchForm",{on:{query:e.onQuery,reset:e.onResetForm}},[a("SearchFormItem",{attrs:{label:"数据来源范围"}},[a("a-select",{staticStyle:{width:"100%"},model:{value:e.form.queryType,callback:function(t){e.$set(e.form,"queryType",t)},expression:"form.queryType"}},[a("a-select-option",{attrs:{value:1}},[e._v("基于数据来源")]),a("a-select-option",{attrs:{value:0}},[e._v("基于条件的范围")])],1)],1),a("SearchFormItem",{attrs:{label:"共享范围"}},[a("SelectUser",{attrs:{multiple:!0,placeholder:"请选择共享范围"},model:{value:e.form.dataShareTo,callback:function(t){e.$set(e.form,"dataShareTo",t)},expression:"form.dataShareTo"}})],1)],1)],1),a("div",[a("div",{staticClass:"tool-bar"},[a("a-button",{attrs:{type:"primary"},on:{click:e.onAdd}},[e._v("新建")])],1),a("div",[a("CustomTable",{ref:"table",attrs:{rowKey:"ruleId",showAlert:!1,showSelection:!1,loading:e.loading.listDataSharing,columns:e.columns,hideColumns:e.hideColumns,dataSource:e.dataSharingData},on:{change:e.onTableChange},scopedSlots:e._u([{key:"expireTo",fn:function(t){return[e._v(" "+e._s(e.moment(t).format("YYYY-MM-DD HH:mm:ss"))+" ")]}},{key:"privValue",fn:function(t){return[e._v(" "+e._s(t?"读写":"只读")+" ")]}},{key:"flagEnable",fn:function(t){return[a("a-badge",{attrs:{status:t?"success":"error"}}),e._v(" "+e._s(t?"启用中":"停用中")+" ")]}},{key:"action",fn:function(t){return[a("a",{on:{click:function(a){return e.onView(a,t)}}},[e._v("查看")]),a("a-divider",{attrs:{type:"vertical"}}),a("a",{on:{click:function(a){return e.onStatus(a,t)}}},[e._v(e._s(t.flagEnable?"停用":"启用"))])]}}])})],1)])],1)},n=[],i=(a("4de4"),a("caad"),a("2532"),a("5530")),s=a("2f62"),o=a("d99e"),l=a("4602"),c=a("8a01"),d=a("a669"),u=o["a"].Item,m={name:"DataShare",components:{SearchForm:o["a"],SearchFormItem:u,AddDataShareModal:l["default"],SelectUser:d["a"],ViewDataShareModal:c["default"]},data:function(){return{tableMetaId:0,form:{queryType:1,dataShareTo:[]},pageFilter:{},hideColumns:[],columns:[{title:"规则名称",dataIndex:"ruleName"},{title:"数据来源",dataIndex:"comeFromName"},{title:"共享范围",dataIndex:"titleShareTo"},{title:"共享权限",dataIndex:"privValue",scopedSlots:{customRender:"privValue"}},{title:"到期时间",dataIndex:"expireTo",scopedSlots:{customRender:"expireTo"}},{title:"状态",dataIndex:"flagEnable",scopedSlots:{customRender:"flagEnable"}},{title:"操作",width:"150px",align:"center",scopedSlots:{customRender:"action"}}],selectedData:{}}},created:function(){this.refresh()},mounted:function(){},computed:Object(i["a"])(Object(i["a"])({},Object(s["d"])({loading:function(e){return e.SysPrivilege.loading},objectsAndConditionsData:function(e){return e.SysPrivilege.objectsAndConditionsData},dataSharingData:function(e){return e.SysPrivilege.dataSharingData}})),{},{customColumns:function(e){return e.columns.filter((function(t){return!t.group||(t.group instanceof Array?t.group.includes(e.showGroup):t.group===e.showGroup)}))}}),methods:Object(i["a"])(Object(i["a"])({},Object(s["b"])({onObjectsAndConditions:"SysPrivilege/onObjectsAndConditions",onListDataSharing:"SysPrivilege/onListDataSharing",onDataSharingStatus:"SysPrivilege/onDataSharingStatus"})),{},{onLeftMenuClick:function(e){var t=e.key;this.tableMetaId=t||0,this.refreshTable()},onQuery:function(){this.pageFilter.currentPage=1,this.refreshTable()},onResetForm:function(){this.form={queryType:1,dataShareTo:[]},this.refreshTable()},onTableChange:function(e){this.pageFilter=e,this.refresh()},refresh:function(){this.onObjectsAndConditions(),this.refreshTable()},refreshTable:function(){this.hideColumns=1===this.form.queryType?["ruleName"]:[],this.onListDataSharing(Object(i["a"])(Object(i["a"])(Object(i["a"])({},this.form),this.pageFilter),{},{tableMetaId:this.tableMetaId}))},onAdd:function(){this.$refs.addDataShareModal.show()},onView:function(e,t){e.stopPropagation(),this.selectedData=t,this.$refs.viewDataShareModal.show()},onStatus:function(e,t){var a=this;e.stopPropagation(),this.onDataSharingStatus({ruleIds:[t.ruleId],flagEnable:!t.flagEnable}).then((function(){a.$message.info("".concat(t.flagEnable?"停用":"启用","成功 ")),a.refresh()}))}})},f=m,h=a("2877"),p=Object(h["a"])(f,r,n,!1,null,null,null);t["default"]=p.exports}}]);